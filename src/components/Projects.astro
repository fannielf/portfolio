---
interface GitHubRepo {
    name: string;
    description: string | null;
    html_url: string;
    fork: boolean;
    stargazers_count: number;
    language: string | null;
    languages_url: string;
}

interface ProjectWithTech extends GitHubRepo {
    technologies: string[];
}

const username = "RuBoMa";

// Fetch repos dynamically
const response = await fetch(`https://api.github.com/users/${username}/repos`);
const repos: GitHubRepo[] = await response.json();

// Filter out forks and sort by stars
const filtered = repos
    .filter((repo: GitHubRepo) => !repo.fork)
    .sort(
        (a: GitHubRepo, b: GitHubRepo) =>
            b.stargazers_count - a.stargazers_count,
    );

// Enhanced project data with manual technology mapping for better accuracy
const projectTechMap: Record<string, string[]> = {
    "ray-tracer": ["Rust", "Graphics", "Math"],
    portfolio: ["Astro", "TypeScript", "Tailwind CSS"],
    rt_2: ["Rust", "Ray Tracing", "Graphics"],
    forum: ["Go", "SQLite", "HTML", "CSS"],
    "piscine-go": ["Go", "Algorithms"],
    "groupie-tracker": ["Go", "Web API", "HTML"],
    "real-time-forum": ["Go", "WebSockets", "SQLite"],
    "ascii-art": ["Go", "CLI"],
    // Add more projects as needed
};

// Combine repos with technology information
const projectsWithTech: ProjectWithTech[] = await Promise.all(
    filtered.map(async (repo) => {
        let technologies = projectTechMap[repo.name] || [];

        // If no manual mapping, use the primary language from GitHub
        if (technologies.length === 0 && repo.language) {
            technologies = [repo.language];
        }

        return {
            ...repo,
            technologies,
        };
    }),
);
---

<section class="max-w-6xl mx-auto my-8 sm:my-12 px-4 sm:px-6">
    <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center">Projects</h2>

    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {
            projectsWithTech.map((project: ProjectWithTech) => (
                <a
                    href={project.html_url}
                    target="_blank"
                    class="group p-5 rounded-2xl shadow-md bg-gray-900 border border-gray-800 hover:border-blue-500 transition transform hover:-translate-y-1 hover:shadow-blue-500/20 flex flex-col"
                >
                    <h3 class="text-xl font-semibold mb-2 group-hover:text-blue-400 transition">
                        {project.name}
                    </h3>
                    <p class="text-gray-400 text-sm mb-3 line-clamp-3 flex-grow">
                        {project.description ?? "No description available"}
                    </p>

                    {/* Technology Tags */}
                    {project.technologies.length > 0 && (
                        <div class="flex flex-wrap gap-2 mb-3">
                            {project.technologies.map((tech: string) => (
                                <span class="px-2 py-1 text-xs bg-blue-900/30 text-blue-300 rounded-full border border-blue-800/50">
                                    {tech}
                                </span>
                            ))}
                        </div>
                    )}

                    <div class="text-gray-500 text-xs flex items-center">
                        <span class="text-yellow-500 mr-1">â˜…</span>
                        {project.stargazers_count}
                    </div>
                </a>
            ))
        }
    </div>
</section>
